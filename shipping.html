<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Shipping Address</title>
<style>
  body { margin:0; font-family:Arial,sans-serif; background:#d58dd3; color:black; }
  .header { display:flex; justify-content:space-between; padding:10px 20px; }
  .container { display:flex; gap:30px; padding:40px; }
  .form-container { flex:1; }
  .form-container h2 { text-align:center; margin-bottom:20px; }
  .form-group { margin-bottom:15px; display:flex; align-items:center; }
  .form-group label { width:100px; font-style:italic; }
  .form-group input, .form-group select { flex:1; padding:8px; border-radius:5px; border:1px solid #ccc; }
  .submit-btn { display:block; margin:20px auto 0; padding:12px 30px; background:#a847a6; color:white; font-weight:bold; border:none; border-radius:8px; cursor:pointer; }
  .submit-btn:hover { background:#922e90; }
  .image-container { flex:1; display:flex; justify-content:center; }
  .image-container img { width:80%; border-radius:50%; object-fit:cover; }
  .note { background:white; border-radius:25px; padding:10px 20px; margin:20px auto; width:fit-content; font-style:italic; font-weight:bold; text-align:center; }
</style>
</head>
<body>
<div class="header">
  <button onclick="window.history.back()">‚Üê</button>
  <input type="text" placeholder="Search...">
  <button>üõí</button>
</div>

<div class="container">
  <div class="form-container">
    <h2>Enter your Shipping address</h2>
    <form onsubmit="saveAndRedirect(event)">
      <div class="form-group"><label>Name</label><input type="text" id="name" required></div>
      <div class="form-group"><label>Email</label><input type="email" id="email" required></div>
      <div class="form-group"><label>Phone</label><input type="text" id="phone" required></div>
      <div class="form-group">
        <label>Country</label>
        <select id="country" required>
          <option value="">-- Select Country --</option>
          <option value="India">India</option>
          <option value="USA">USA</option>
          <option value="UK">UK</option>
          <option value="Canada">Canada</option>
          <option value="Australia">Australia</option>
        </select>
      </div>
      <div class="form-group">
        <label>State</label>
        <select id="state" required>
          <option value="">-- Select State --</option>
          <option value="Tamil Nadu">Tamil Nadu</option>
          <option value="Kerala">Kerala</option>
          <option value="Karnataka">Karnataka</option>
          <option value="Maharashtra">Maharashtra</option>
          <option value="Delhi">Delhi</option>
          <option value="California">California</option>
          <option value="Texas">Texas</option>
          <option value="New York">New York</option>
          <option value="Queensland">Queensland</option>
          <option value="Ontario">Ontario</option>
        </select>
      </div>
      <div class="form-group"><label>Address</label><input type="text" id="address" required></div>
      <div class="form-group"><label>Zip code</label><input type="text" id="zip" required></div>
      <button type="submit" class="submit-btn">Place Order</button>
    </form>
  </div>

  <div class="image-container">
    <!-- Replace with a relative path inside your project -->
    <img src="C:\Users\Ritha\OneDrive\Desktop\how-to-start-an-online-store.webp" alt="Shopping Image">
  </div>
</div>

<div class="note">NOTE: ONLY CASH ON DELIVERY FACILITY IS AVAILABLE</div>

<script>
function saveAndRedirect(event){
  event.preventDefault();

  let cart = JSON.parse(localStorage.getItem("cart")) || [];

  // For testing: auto-add dummy product if cart empty
  if(cart.length === 0){
    cart = [{name:"Test Product", price:500, quantity:1, size:"M"}];
  }

  const name = document.getElementById("name").value;
  const email = document.getElementById("email").value;
  const phone = document.getElementById("phone").value;
  const country = document.getElementById("country").value;
  const state = document.getElementById("state").value;
  const address = document.getElementById("address").value;
  const zip = document.getElementById("zip").value;

  let orders = JSON.parse(localStorage.getItem("orders")) || [];
  let orderDate = new Date().toISOString().split("T")[0];

  let orderId = orders.length ? Math.max(...orders.map(o => parseInt(o.orderId))) + 1 : 1;

  cart.forEach(item => {
    orders.push({
      id: orderId + "-" + item.name,
      orderId: orderId,
      customerName: name,
      productName: item.name,
      quantity: item.quantity,
      orderDate: orderDate,
      status: "Pending",
      shippingAddress: { country, state, address, zip }
    });
  });

  localStorage.setItem("orders", JSON.stringify(orders));

  const orderData = {
    name, email, phone, country, state, address, zip,
    date: orderDate,
    cart
  };
  localStorage.setItem("orderData", JSON.stringify(orderData));

  let customers = JSON.parse(localStorage.getItem("customers")) || [];
  let existingCustomer = customers.find(c => c.email === email);
  if(existingCustomer){
    existingCustomer.name = name; existingCustomer.phone = phone;
  } else {
    customers.push({id: customers.length+1, name, email, phone});
  }
  localStorage.setItem("customers", JSON.stringify(customers));

  let invoices = JSON.parse(localStorage.getItem("invoices")) || [];
  cart.forEach(item=>{
    invoices.push({
      invoiceId: "INV"+(invoices.length+1),
      customerName: name,
      emailId: email,
      productName: item.name,
      productSize: item.size||"M",
      quantity: item.quantity,
      totalAmount: item.price*item.quantity,
      orderDate: orderDate,
      paymentStatus: "Pending"
    });
  });
  localStorage.setItem("invoices", JSON.stringify(invoices));

  localStorage.removeItem("cart");
  alert("Order placed successfully!");
  window.location.href="confirm.html"; 
}
</script>
</body>
</html>
